<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%

	String memberId = request.getParameter("memberId");
	boolean available = (boolean)request.getAttribute("available");
%>


<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>아이디중복검사</title>
<script src="<%=request.getContextPath()%>/js/jquery-3.6.0.js"></script>
<style>
div#checkId-container{text-align:center; padding-top:50px;}
span#duplicated{color:red; font-weight:bold;}
</style>
</head>
<body>
	<div id="checkId-container">
	<% if(available) { %>
		<%-- 아이디를 사용가능한 경우 --%>
		<p>[<%= memberId %>]는 사용가능합니다.  </p>
		<input type="button" value="사용하기" onclick="self.close();" /> <%-- 사용하기버튼클릭시 창닫기 --%>
	<% } else { %>
		<%-- 아이디를 사용불가한 경우 --%>
		<p>[<span id="duplicated"><%= memberId %></span>]는 이미 사용중입니다.  </p>
		<form name="checkIdDuplicateFrm">
			<input type="text" name="memberId" placeholder="아이디를 입력하세요."/>
			<input type="button" value="중복검사" onclick="checkIdDuplicate();"/>
		</form>
	<% } %>
	
	</div>
	
<script>

	function checkIdDuplicate() {
		var $memberId = $("#memberId_");
		if(/^[\w]{4,}$/.test($memberId.val()) == false){
			alert("유효한 아이디를 입력하세요");
			$memberId.select();
			return;
		}
		
		//1. 팝업생성
		//popup window객체의 name속성 : checkIdDuplicatePopup
		var title = "checkIdDuplicatePopup";
		open("",title,"width=300px, height=200px, left=200px, top=200px");
		
		//2. 폼제출
		$frm = $(document.checkIdDuplicateFrm);
		$frm.find("[name=memberId]").val($memberId.val()); //checkIdDuplicateFrm의 memberId input태그에 사용자입력id세팅
		$frm.attr("action", "<%= request.getContextPath() %>/member/checkIdDuplicate")
			.attr("method", "POST")
			.attr("target", title) //popup과 form을 연결
			.submit();
	}
	
</script>	
</body>
</html>
